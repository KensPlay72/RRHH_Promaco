{% load static %}
{% load humanize %}
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
            {% block title %}Editar Perfil de Puesto{% endblock %}
        </title>
        <link rel="stylesheet"
              href="{% static 'css/perfilpuesto/perfilpuesto.css' %}">
        <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
        <link rel="icon"
              href="{% static 'img/promacoico.ico' %}"
              type="image/x-icon">
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
    </head>
    <body>
        <div class="container1">
            <br>
            <br>
            <div class="cinta1div">
                <div class="cinta"></div>
            </div>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <div class="imgdiv">
                <h1 style="font-size: 50px">ACTUALIZAR PERFIL {{ perfil_puesto.id }}</h1>
                <input type="hidden" id="perfil_puesto_id" value="{{ perfil_puesto.id }}">
            </div>
            <div class="imgdiv">
                <img src="{% static 'img/LOGOPRINCIPAL.png' %}" alt="Logo PROMACO">
            </div>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <div class="cinta2div">
                <div class="cinta2"></div>
            </div>
            <br>
            <br>
        </div>
        <br>
        <br>
        <div class="container2">
            <form enctype="multipart/form-data" autocomplete="off">
                <div class="encabezado">
                    <h3>1.  IDENTIFICACION DEL CARGO</h3>
                    <h5 id="text">{{ perfil_puesto.tipo_perfil }}</h5>
                    <button type="button"
                            id="toggleButton"
                            class="btn classbotones"
                            onclick="toggleTextAndField()">PUESTO NUEVO</button>
                </div>
                <table class="tabla-informacion">
                    <tr>
                        <td>
                            <strong>EMPRESA</strong>
                        </td>
                        <td class="selectpuesto">
                            <select name="empresa" id="empresa_select">
                                <option value="" disabled>Seleccione una Empresa</option>
                                {% for item in all_empresas %}
                                    <option value="{{ item.id }}"
                                            {% if item.id == perfil_puesto.empresa %}selected{% endif %}>
                                        {{ item.nombre_empresa }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>NOMBRE DEL CARGO</strong>
                        </td>
                        <td class="selectpuesto">
                            <select name="nombre_cargo" id="nombre_cargo">
                                <option value="" selected disabled>Seleccione un Puesto</option>
                                {% for item in all_puestos %}
                                    <option value="{{ item.id }}"
                                            {% if item.id == perfil_puesto.nombre_cargo_id %}selected{% endif %}>
                                        {{ item.nombre_puestos }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>DEPARTAMENTO</strong>
                        </td>
                        <td class="selectpuesto">
                            <select name="departamento" id="departamento_select">
                                <option value="" selected disabled>Seleccione un Departamento</option>
                                {% for item in all_departamentos %}
                                    <option value="{{ item.id }}"
                                            {% if item.id == perfil_puesto.departamento_id %}selected{% endif %}>
                                        {{ item.nombre_departamento }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>CARGO AL QUE REPORTA</strong>
                        </td>
                        <td class="selectpuesto">
                            <select name="cargo_reportan_select" id="cargo_reportan_select">
                                <option value="" selected disabled>Seleccione un Puesto</option>
                                {% for item in all_puestos %}
                                    <option value="{{ item.id }}"
                                            {% if item.id == perfil_puesto.cargo_al_que_reporta_id %}selected{% endif %}>
                                        {{ item.nombre_puestos }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>CARGOS QUE LE REPORTAN</strong>
                        </td>
                        <td class="selectpuesto">
                            <select name="cargo_lereportan_select"
                                    id="cargo_lereportan_select"
                                    multiple
                                    size="10">
                                {% for item in all_puestos %}
                                    <option value="{{ item.id }}"
                                            {% if item.id in ids_seleccionados %}selected{% endif %}>
                                        {{ item.nombre_puestos }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                </table>
                <br>
                <h4>2.  REQUISITOS Y CONDICIONES DEL PERFIL</h4>
                <table class="tabla-informacion">
                    <tr>
                        <td>
                            <strong>EDUCACIÓN UNIVERSITARIA</strong>
                        </td>
                        <td class="selectpuesto">
                            <input type="text"
                                   name="educacion"
                                   id="educacion_input"
                                   class="inputpuesto"
                                   value="{{ perfil_puesto.educacion_universitario }}"
                                   placeholder="Ingrese la educación">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>POSTGRADOS / ESPECIALIZACIONES</strong>
                        </td>
                        <td class="selectpuesto">
                            <input type="text"
                                   name="postgrado_especialidades"
                                   id="postgrado_especialidades"
                                   class="inputpuesto"
                                   value="{{ perfil_puesto.postgrado_especializaciones }}"
                                   placeholder="Ingrese los postgrado y especializaciones">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>FORMACIÓN COMPLEMENTARIA</strong>
                        </td>
                        <td class="selectpuesto">
                            <input type="text"
                                   name="formacion_complementaria"
                                   id="formacion_complementaria"
                                   class="inputpuesto"
                                   value="{{ perfil_puesto.formacion_complementaria }}"
                                   placeholder="Formación complementaria">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>IDIOMAS (ESPECIFICAR NIVEL)</strong>
                        </td>
                        <td class="selectpuesto1" style="display: flex; width: 100%;">
                            <input type="text"
                                   name="idioma"
                                   id="idioma_input"
                                   class="inputpuesto1"
                                   value="{{ perfil_puesto.idiomas }}"
                                   placeholder="Ingrese el idioma">
                            <p>|</p>
                            <select name="nivel_idioma" id="nivel_idioma_select">
                                <option value="" disabled>Seleccione el nivel</option>
                                <option value="PRINCIPIANTE"
                                        {% if perfil_puesto.nivel_idioma == "PRINCIPIANTE" %}selected{% endif %}>
                                    PRINCIPIANTE
                                </option>
                                <option value="INTERMEDIO"
                                        {% if perfil_puesto.nivel_idioma == "INTERMEDIO" %}selected{% endif %}>
                                    INTERMEDIO
                                </option>
                                <option value="AVANZADO"
                                        {% if perfil_puesto.nivel_idioma == "AVANZADO" %}selected{% endif %}>
                                    AVANZADO
                                </option>
                                <option value="NATIVO"
                                        {% if perfil_puesto.nivel_idioma == "NATIVO" %}selected{% endif %}>
                                    NATIVO
                                </option>
                            </select>
                        </td>
                    </tr>
                </table>
                <br>
                <table class="tabla-informacion">
                    <tr>
                        <td colspan="3" style="text-align:center; padding: 10px;">
                            <strong>COMPETENCIAS DEL CARGO</strong>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3"
                            style="text-align:center;
                                   background-color: #FFF59D;
                                   color:black;
                                   padding: 10px">
                            <strong>TÉCNICAS</strong>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>AÑOS DE EXPERIENCIA</strong>
                        </td>
                        <td colspan="2" class="selectpuesto">
                            <input type="text"
                                   name="anosexperiencia"
                                   id="anosexperiencia_input"
                                   class="inputpuesto"
                                   value="{{ perfil_puesto.anos_experiencia }}"
                                   placeholder="Ingrese la cantidad de años de experiencia que desea">
                        </td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <tr>
                            <td colspan="2"
                                style="text-align:center;
                                       background-color: #FFF59D;
                                       color:black;
                                       padding: 10px">
                                <strong>CONDUCTUALES</strong>
                            </td>
                            <td style="text-align:center;
                                       background-color: #FFF59D;
                                       color:black;
                                       padding: 10px">NIVEL REQURIDO</td>
                        </tr>
                        <tr>
                            <td style="text-align:center; justify-content:center;">
                                <strong>PENSAMIENTO ESTRATEGICO</strong>
                            </td>
                            <td class="selectpuesto" style="text-align:justify; padding: 10px;">
                                <p>
                                    Comprende rápidamente los cambios del entorno, las oportunidades del mercado, las amenazas competitivas y las fortalezas y debilidades de la organización a la hora de identificar la mejor respuesta estratégica. Posee la capacidad para detectar nuevas oportunidades de negocio, realizar alianzas estratégicas con clientes, proveedores y competidores. Puede adecuarse a los cambios de contexto e interpretar adecuadamente la información de la que dispone. Identificar a las personas que podrían ayudarlo alcanzar objetivos. Es capaz de leer al equipo e identificar la capacidad del mismo ante un desafío.
                                </p>
                            </td>
                            <td class="selectpuesto">
                                <select name="nivel_pensamiento"
                                        id="nivel_pensamiento_select"
                                        class="selectcentrado">
                                    <option value="" disabled>Seleccione el nivel</option>
                                    <option value="Alto"
                                            {% if perfil_puesto.pensamiento_estrategico == "Alto" %}selected{% endif %}>
                                        Alto
                                    </option>
                                    <option value="Medio"
                                            {% if perfil_puesto.pensamiento_estrategico == "Medio" %}selected{% endif %}>
                                        Medio
                                    </option>
                                    <option value="Bajo"
                                            {% if perfil_puesto.pensamiento_estrategico == "Bajo" %}selected{% endif %}>
                                        Bajo
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:center; justify-content:center;">
                                <strong>ENFOQUE AL CLIENTE</strong>
                            </td>
                            <td class="selectpuesto" style="text-align:justify; padding: 10px;">
                                <p>
                                    Identifica las necesidades del cliente, muestra deseo de ayudar, comprender y satisfacer su demanda. Implica esforzarse por conocer y resolver los problemas a través de la prestación eficaz de un servicio y la actitud positiva permanente que brindé valor agregado y superé toda expectativa. Incluye comunicación asertiva y sincera con el cliente.
                                </p>
                            </td>
                            <td class="selectpuesto">
                                <select name="nivel_cliente" id="nivel_cliente_select" class="selectcentrado">
                                    <option value="" disabled>Seleccione el nivel</option>
                                    <option value="Alto"
                                            {% if perfil_puesto.enfoque_al_cliente == "Alto" %}selected{% endif %}>
                                        Alto
                                    </option>
                                    <option value="Medio"
                                            {% if perfil_puesto.enfoque_al_cliente == "Medio" %}selected{% endif %}>
                                        Medio
                                    </option>
                                    <option value="Bajo"
                                            {% if perfil_puesto.enfoque_al_cliente == "Bajo" %}selected{% endif %}>
                                        Bajo
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:center; justify-content:center;">
                                <strong>PLANIFICACION Y ORGANIZACIÓN</strong>
                            </td>
                            <td class="selectpuesto" style="text-align:justify; padding: 10px;">
                                <p>
                                    Determina eficazmente las metas y prioridades de la tarea, área y/o proyecto, estipulando acciones y plazos requeridos. Desarrolla un plan de trabajo para optimizar los recursos y alcanzar los objetivos, incluye la instrumentación de mecanismos de seguimiento y verificación de información.
                                </p>
                            </td>
                            <td class="selectpuesto">
                                <select name="nivel_planificacion"
                                        id="nivel_planificacion_select"
                                        class="selectcentrado">
                                    <option value="" disabled>Seleccione el nivel</option>
                                    <option value="Alto"
                                            {% if perfil_puesto.planificacion_y_organizacion == "Alto" %}selected{% endif %}>
                                        Alto
                                    </option>
                                    <option value="Medio"
                                            {% if perfil_puesto.planificacion_y_organizacion == "Medio" %}selected{% endif %}>
                                        Medio
                                    </option>
                                    <option value="Bajo"
                                            {% if perfil_puesto.planificacion_y_organizacion == "Bajo" %}selected{% endif %}>
                                        Bajo
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:center; justify-content:center;">
                                <strong>COMUNICACIÓN</strong>
                            </td>
                            <td class="selectpuesto" style="text-align:justify; padding: 10px;">
                                <p>
                                    Escucha y expresa conceptos e ideas de forma efectiva y asertiva. Sabe cuándo y a quien debe dirigirse para llevar a cabo su propósito. Escucha activamente, incluye la capacidad de comunicarse con un lenguaje verbal y no verbal adecuado y su redacción clara y precisa.
                                </p>
                            </td>
                            <td class="selectpuesto">
                                <select name="nivel_comunicacion"
                                        id="nivel_comunicacion_select"
                                        class="selectcentrado">
                                    <option value="" disabled>Seleccione el nivel</option>
                                    <option value="Alto"
                                            {% if perfil_puesto.comunicacion == "Alto" %}selected{% endif %}>
                                        Alto
                                    </option>
                                    <option value="Medio"
                                            {% if perfil_puesto.comunicacion == "Medio" %}selected{% endif %}>
                                        Medio
                                    </option>
                                    <option value="Bajo"
                                            {% if perfil_puesto.comunicacion == "Bajo" %}selected{% endif %}>
                                        Bajo
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align:center; justify-content:center;">
                                <strong>ORIENTACION AL LOGRO</strong>
                            </td>
                            <td class="selectpuesto" style="text-align:justify; padding: 10px;">
                                <p>
                                    Logra resultados actuando con diligencia, agilidad y sentido de urgencia ante las decisiones importantes, alineación de esfuerzos y monitoreando el progreso de sus objetivos. Tiene la capacidad de administrar los procesos establecidos, de forma tal que no interfieran con la consecución de metas, gestionando oportunamente estándares, mejorando y manteniendo altos niveles de rendimiento en el marco de las estrategias de la organización.
                                </p>
                            </td>
                            <td class="selectpuesto">
                                <select name="nivel_logro" id="nivel_logro_select" class="selectcentrado">
                                    <option value="" disabled>Seleccione el nivel</option>
                                    <option value="Alto"
                                            {% if perfil_puesto.orientacion_al_logro == "Alto" %}selected{% endif %}>
                                        Alto
                                    </option>
                                    <option value="Medio"
                                            {% if perfil_puesto.orientacion_al_logro == "Medio" %}selected{% endif %}>
                                        Medio
                                    </option>
                                    <option value="Bajo"
                                            {% if perfil_puesto.orientacion_al_logro == "Bajo" %}selected{% endif %}>
                                        Bajo
                                    </option>
                                </select>
                            </td>
                        </tr>
                    </tr>
                </table>
                <br>
                <table class="tabla-informacion">
                    <tr>
                        <td style="text-align:center; padding: 10px;">
                            <strong>MISIÓN DEL CARGO Objetivo/ Propósito</strong>
                        </td>
                    </tr>
                    <tr>
                        <td style=" background-color:white;">
                            <textarea name=""
                                      id="mision_cargo"
                                      placeholder="MISION DEL CARGO"
                                      class="inputpuesto"
                                      rows="3">{{ perfil_puesto.mision_cargo }}</textarea>
                        </td>
                    </tr>
                    <tr>
                        <td style="background-color:white; color:black;">
                            <br>
                            <p>Organigrama</p>
                            <div class="file-drop-area">
                                <input type="file" class="file-input" id="fileInput_org" accept="image/*" />
                                <div class="file-message"></div>
                                {% if perfil_puesto.ruta_organigrama %}
                                    <img id="previewImage_org"
                                         src="/static/img/organigrama/{{ perfil_puesto.nombre_organigrama }}"
                                         alt="Foto" />
                                {% else %}
                                    Foto
                                {% endif %}
                            </div>
                            <br>
                            <br>
                        </td>
                    </tr>
                </table>
                <table class="tabla-informacion2" id="tablaFunciones">
                    <tr>
                        <td colspan="4" style="text-align:center; padding: 10px;">
                            <strong>FUNCIONES DEL CARGO</strong>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:center;
                                   background-color: #FFF59D;
                                   color:black;
                                   padding: 10px">N*</td>
                        <td style="text-align:center;
                                   background-color: #FFF59D;
                                   color:black;
                                   padding: 10px">Función: Qué hace, sobre qué y con qué fines</td>
                        <td style="text-align:center;
                                   background-color: #FFF59D;
                                   color:black;
                                   padding: 10px">Periodicidad</td>
                        <td style="text-align:center;
                                   background-color: #FFF59D;
                                   color:black;
                                   padding: 10px">
                            Importancia de la función para lograr el objetivo del cargo (A-B-C)
                        </td>
                    </tr>
                    {% for funcion in funciones_cargo %}
                        <tr class="funcionRow">
                            <td class="numero-columna"
                                style="text-align:center;
                                       background-color: white;
                                       color:black">{{ forloop.counter }}</td>
                            <td class="selectpuesto"
                                style="text-align:center;
                                       background-color: white;
                                       color:black">
                                <input type="text"
                                       name="funcion[]"
                                       class="inputpuesto funcionInput"
                                       value="{{ funcion.funcion }}"
                                       placeholder="Ingrese la Funcion">
                            </td>
                            <td class="selectpuesto"
                                style="text-align:center;
                                       background-color: white;
                                       color:black">
                                <select name="periodicidad[]" class="inputpuesto">
                                    <option value=""
                                            disabled
                                            {% if not funcion.periodicidad %}selected{% endif %}>
                                        Seleccione una Periodicidad
                                    </option>
                                    <option value="SEMANAL"
                                            {% if funcion.periodicidad == "SEMANAL" %}selected{% endif %}>
                                        SEMANAL
                                    </option>
                                    <option value="DIARIA"
                                            {% if funcion.periodicidad == "DIARIA" %}selected{% endif %}>
                                        DIARIA
                                    </option>
                                    <option value="MENSUAL"
                                            {% if funcion.periodicidad == "MENSUAL" %}selected{% endif %}>
                                        MENSUAL
                                    </option>
                                    <option value="SEMANAL Y MENSUAL"
                                            {% if funcion.periodicidad == "SEMANAL Y MENSUAL" %}selected{% endif %}>
                                        SEMANAL Y MENSUAL
                                    </option>
                                </select>
                            </td>
                            <td class="selectpuesto"
                                style="text-align:center;
                                       background-color: white;
                                       color:black">
                                <select name="importancia[]" class="inputpuesto">
                                    <option value="" disabled {% if not funcion.importancia %}selected{% endif %}>Seleccione la importancia</option>
                                    <option value="A" {% if funcion.importancia == "A" %}selected{% endif %}>A</option>
                                    <option value="B" {% if funcion.importancia == "B" %}selected{% endif %}>B</option>
                                    <option value="C" {% if funcion.importancia == "C" %}selected{% endif %}>C</option>
                                </select>
                            </td>
                        </tr>
                    {% endfor %}
                    <!-- Fila vacía inicial -->
                    <tr class="funcionRow">
                        <td class="numero-columna"
                            style="text-align:center;
                                   background-color: white;
                                   color:black">{{ funciones_cargo|length|add:"1" }}</td>
                        <td class="selectpuesto"
                            style="text-align:center;
                                   background-color: white;
                                   color:black">
                            <input type="text"
                                   name="funcion[]"
                                   class="inputpuesto funcionInput"
                                   placeholder="Ingrese la Funcion">
                        </td>
                        <td class="selectpuesto"
                            style="text-align:center;
                                   background-color: white;
                                   color:black">
                            <select name="periodicidad[]" class="inputpuesto">
                                <option value="" selected disabled>Seleccione una Periodicidad</option>
                                <option value="SEMANAL">SEMANAL</option>
                                <option value="DIARIA">DIARIA</option>
                                <option value="MENSUAL">MENSUAL</option>
                                <option value="SEMANAL Y MENSUAL">SEMANAL Y MENSUAL</option>
                            </select>
                        </td>
                        <td class="selectpuesto"
                            style="text-align:center;
                                   background-color: white;
                                   color:black">
                            <select name="importancia[]" class="inputpuesto">
                                <option value="" selected disabled>Seleccione la importancia</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                            </select>
                        </td>
                    </tr>
                </table>
                <br>
                <p>A: Muy importantes para lograr los objetivos marcados.</p>
                <p>B: Medianamente importante para lograr los objetivos.</p>
                <p>C: Prácticamente sin importancia para lograr los objetivos.</p>
                <br>
                <table class="tabla-informacion1" id="tablaDificultades">
                    <tr>
                        <td colspan="1" style="text-align:center; padding: 10px;">
                            <strong>ALCANCE DE LAS DIFICULTADES (RETOS)</strong>
                            <br>
                            <small>
                                Son las situaciones más complejas que el cargo podrá afrontar/resolver en el desarrollo
                                de su trabajo o las que pueden generar retrasos.
                            </small>
                        </td>
                    </tr>
                    {% for dificultad in dificultades_perfil %}
                        <tr class="dificultadRow">
                            <td class="selectpuesto"
                                style="text-align:center;
                                       background-color: white;
                                       color:black">
                                <input type="text"
                                       name="dificultad[]"
                                       class="inputpuesto dificultadInput"
                                       value="{{ dificultad.descripcion }}"
                                       placeholder="Ingrese la Dificultad">
                            </td>
                        </tr>
                    {% endfor %}
                    <!-- Fila vacía inicial para nuevas dificultades -->
                    <tr class="dificultadRow">
                        <td class="selectpuesto"
                            style="text-align:center;
                                   background-color: white;
                                   color:black">
                            <input type="text"
                                   name="dificultad[]"
                                   class="inputpuesto dificultadInput"
                                   placeholder="Ingrese la Dificultad">
                        </td>
                    </tr>
                </table>
                <br>
                <table class="tabla-informacion1" id="tablaMateriales_equipos">
                    <tr>
                        <td style="text-align:center;
                                   background-color: #FFF59D;
                                   color:black;
                                   padding: 10px"
                            colspan="3">
                            <strong>Materiales y Equipos</strong>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="padding: 10px; background-color:white;">
                            <div class="checkbox-container">
                                {% for nombre in materiales_predefinidos %}
                                    <label class="custom-checkbox">
                                        {{ nombre|title }}
                                        <input type="checkbox"
                                               name="material[]"
                                               value="{{ nombre }}"
                                               {% if nombre in materiales_seleccionados %}checked{% endif %}>
                                        <span class="checkmark"></span>
                                    </label>
                                {% endfor %}
                                <label class="custom-checkbox"
                                       id="otrosLabel"
                                       style="display: flex;
                                              align-items: center">
                                    Otros
                                    <input type="checkbox"
                                           name="material[]"
                                           id="checkboxOtros_equipos"
                                           value="Otros"
                                           {% if materiales_otros %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                    <input type="text"
                                           id="inputOtros_equipos"
                                           name="material_otros"
                                           placeholder="Especifica otros"
                                           class="input-limpio"
                                           style="display: {% if materiales_otros %}inline-block{% else %}none{% endif %}"
                                           value="{% if materiales_otros %}{{ materiales_otros.0 }}{% endif %}">
                                </label>
                            </div>
                        </td>
                    </tr>
                </table>
                <br>
                <table class="tabla-informacion1">
                    <tr>
                        <td colspan="3" style="text-align:center; padding: 10px;">
                            <strong>CONDICIONES</strong>
                        </td>
                    </tr>
                    <tr>
                        <td rowspan="2"
                            style="text-align:center;
                                   background-color: #FFF59D;
                                   color:black;
                                   padding: 10px">Horarios, turnos y condiciones relacionadas</td>
                        <td colspan="2" class="selectpuesto" style=" background-color:white;">
                            <label class="custom-checkbox"
                                   style="display:flex;
                                          justify-content:center;
                                          align-items:center;
                                          margin-top: 15px;
                                          margin-left: 10px">
                                Residir en el Área
                                <input type="checkbox"
                                       id="recidirarea"
                                       value="Residir en el Area"
                                       {% if perfil_puesto.residir_en_area == True %}checked{% endif %}>
                                <span class="checkmark"></span>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" class="selectpuesto" style="background-color:white;">
                            <label for="hora_entrada"
                                   style="flex: 1;
                                          margin: 0;
                                          color:black;
                                          margin-left:80px">
                                Entrada:
                                <input type="time"
                                       name="hora_entrada"
                                       id="hora_entrada"
                                       class="inputpuesto"
                                       required
                                       value="{{ hora_entrada }}">
                            </label>
                            <label for="hora_salida"
                                   style="flex: 1;
                                          margin: 0;
                                          color:black;
                                          margin-left:100px">
                                Salida:
                                <input type="time"
                                       name="hora_salida"
                                       id="hora_salida"
                                       class="inputpuesto"
                                       required
                                       value="{{ hora_salida }}">
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:center;
                                   background-color: #FFF59D;
                                   color:black;
                                   padding: 10px">Otros que se consideren importantes</td>
                        <td colspan="2" style=" background-color:white;">
                            <textarea name="" id="otros_importantes_textarea" class="inputpuesto" rows="3">{{ perfil_puesto.otros_considere }}</textarea>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:center;
                                   background-color: #FFF59D;
                                   color:black;
                                   padding: 10px">Plan de compensación</td>
                        <td colspan="2" style="background-color:white; padding: 10px;">
                            <div class="custom-checkbox-container">
                                <!-- Primera parte: Plan de compensación -->
                                <!-- Compensaciones -->
                                <label class="custom-checkbox2">
                                    Salario Base
                                    <input type="checkbox"
                                           name="compensacion[]"
                                           value="SALARIO BASE"
                                           {% if "SALARIO BASE" in compensaciones_seleccionadas %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Comisión
                                    <input type="checkbox"
                                           name="compensacion[]"
                                           value="COMISION"
                                           {% if "COMISION" in compensaciones_seleccionadas %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Bono
                                    <input type="checkbox"
                                           name="compensacion[]"
                                           value="BONO"
                                           {% if "BONO" in compensaciones_seleccionadas %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Depreciación y Combustible
                                    <input type="checkbox"
                                           name="compensacion[]"
                                           value="DEPRECIACION Y COMBUSTIBLE"
                                           {% if "DEPRECIACION Y COMBUSTIBLE" in compensaciones_seleccionadas %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Hospedaje
                                    <input type="checkbox"
                                           name="compensacion[]"
                                           value="HOSPEDAJE"
                                           {% if "HOSPEDAJE" in compensaciones_seleccionadas %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Otros
                                    <input type="checkbox"
                                           id="otrosCheckboxCompensacion"
                                           name="compensacion[]"
                                           value="Otros"
                                           {% if compensaciones_otros %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                    <input type="text"
                                           id="inputOtrosCompensacion"
                                           name="compensacion_otros"
                                           placeholder="Especifica otros"
                                           class="input-limpio"
                                           style="display: {% if compensaciones_otros %}inline-block{% else %}none{% endif %}"
                                           value="{{ compensaciones_otros }}">
                                </label>
                                <!-- Separador: Beneficio Promaco -->
                                <div style="width: 100%; text-align: left; padding: 10px 0;">
                                    <strong>Beneficio Promaco</strong>
                                </div>
                                <!-- Segunda parte: Beneficio Promaco -->
                                <!-- Beneficios Promaco -->
                                <label class="custom-checkbox2">
                                    Seguro médico privado
                                    <input type="checkbox"
                                           name="beneficio[]"
                                           value="SEGURO MEDICO PRIVADO"
                                           {% if "SEGURO MEDICO PRIVADO" in beneficios_seleccionados %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Seguro social
                                    <input type="checkbox"
                                           name="beneficio[]"
                                           value="SEGURO SOCIAL"
                                           {% if "SEGURO SOCIAL" in beneficios_seleccionados %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Permiso de estudio
                                    <input type="checkbox"
                                           name="beneficio[]"
                                           value="PERMISO DE ESTUDIO"
                                           {% if "PERMISO DE ESTUDIO" in beneficios_seleccionados %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Bono supermercado
                                    <input type="checkbox"
                                           name="beneficio[]"
                                           value="BONO SUPERMERCADO"
                                           {% if "BONO SUPERMERCADO" in beneficios_seleccionados %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Bono café Promaco
                                    <input type="checkbox"
                                           name="beneficio[]"
                                           value="BONO CAFE PROMACO"
                                           {% if "BONO CAFE PROMACO" in beneficios_seleccionados %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Descuento en supermercado
                                    <input type="checkbox"
                                           name="beneficio[]"
                                           value="DESCUENTO EN SUPERMERCADO"
                                           {% if "DESCUENTO EN SUPERMERCADO" in beneficios_seleccionados %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Descuento en clínicas y laboratorios
                                    <input type="checkbox"
                                           name="beneficio[]"
                                           value="DESCUENTO EN CLINICA Y LAVORATORIOS"
                                           {% if "DESCUENTO EN CLINICA Y LAVORATORIOS" in beneficios_seleccionados %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                                <label class="custom-checkbox2">
                                    Seguro de vehículo
                                    <input type="checkbox"
                                           name="beneficio[]"
                                           value="SEGURO DE VEHICULO"
                                           {% if "SEGURO DE VEHICULO" in beneficios_seleccionados %}checked{% endif %}>
                                    <span class="checkmark2"></span>
                                </label>
                            </div>
                        </td>
                    </tr>
                </table>
                <br>
                <table class="tabla-informacion">
                    <tr>
                        <td colspan="2" style="text-align:center; padding: 10px;">
                            <strong>PRUEBAS PSICOMETRICAS</strong>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:center; padding: 10px;">Nivel de la Prueba</td>
                        <td class="selectpuesto">
                            <select name="nivel_psicosmart" id="nivel_psicosmart" class="selectcentrado">
                                <option value="" selected disabled>Seleccione el nivel de la prueba</option>
                                <option value="1" {% if nivel_spicosmart.id == 1 %}selected{% endif %}>1</option>
                                <option value="2" {% if nivel_spicosmart.id == 2 %}selected{% endif %}>2</option>
                                <option value="3" {% if nivel_spicosmart.id == 3 %}selected{% endif %}>3</option>
                                <option value="4" {% if nivel_spicosmart.id == 4 %}selected{% endif %}>4</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2"
                            style="text-align:center;
                                   padding: 10px;
                                   display:none;
                                   width: 200%"
                            id="pruebas_td1">
                            <strong>Nombres de las Pruebas</strong>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:center;
                                   background-color: white;
                                   color:black;
                                   padding: 10px;
                                   display:none;
                                   width: 200%"
                            id="pruebas_td"></td>
                    </tr>
                </table>
                <br>
                <table class="tabla-informacion1" id="tablaMateriales_pruebas">
                    <tr>
                        <td colspan="3" style="padding: 10px; background-color:white;">
                            <div class="checkbox-container">
                                <label class="custom-checkbox">
                                    Montacarga
                                    <input type="checkbox"
                                           name="montacargas"
                                           id="montacargas"
                                           value="MONTACARGA"
                                           {% if perfil_puesto.montacargas == True %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                </label>
                                <label class="custom-checkbox">
                                    Equipo pesado
                                    <input type="checkbox"
                                           name="equipo_pesado"
                                           id="equipo_pesado"
                                           value="EQUIPO PESADO"
                                           {% if perfil_puesto.equipo_pesado == True %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                        </td>
                    </tr>
                </table>
                <br>
                <table class="tabla-informacion1" id="tablaIndicadores">
                    <tr>
                        <td style="text-align:center; padding: 10px;">
                            <strong>Principales Indicadores</strong>
                        </td>
                    </tr>
                    {% for indicador in indicadores %}
                        <tr class="indicadorRow">
                            <td class="selectpuesto"
                                style="text-align:center;
                                       background-color: white;
                                       color:black">
                                <input type="text"
                                       name="indicador[]"
                                       class="inputpuesto indicadorInput"
                                       placeholder="Ingrese el Indicador"
                                       value="{{ indicador.descripcion }}">
                            </td>
                        </tr>
                    {% endfor %}
                    <tr class="indicadorRow">
                        <td class="selectpuesto"
                            style="text-align:center;
                                   background-color: white;
                                   color:black">
                            <input type="text"
                                   name="indicador[]"
                                   class="inputpuesto indicadorInput"
                                   placeholder="Ingrese el Indicador"
                                   value="{{ indicador.descripcion }}">
                        </td>
                    </tr>
                </table>
                <br>
                <br>
                <div style="width: 100%;
                            display:flex;
                            justify-content:center;
                            aling-items: center">
                    <button type="button" id="btn-update-perfilpuesto" class="btn classbotones">Actualizar</button>
                </div>
                <br>
            </div>
        </form>
        <button class="print-button1"
                onclick="window.location.href='{% url 'perfilpuesto' %}'">Volver</button>
        <script src="{% static 'js/plugins/bootstrap.min.js' %}"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            var fileDropArea = document.querySelector('.file-drop-area');
            var fileInput = fileDropArea.querySelector('input[type="file"]');
            var fileMessage = fileDropArea.querySelector('.file-message');
            var previewImage = fileDropArea.querySelector('#previewImage_org');  // Usar #previewImage_org en lugar de #previewImage
        
            if (fileInput && previewImage && fileMessage) {
                // Evitar el comportamiento por defecto para eventos de arrastrar y soltar
                fileDropArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    fileDropArea.classList.add('dragover');
                });
        
                fileDropArea.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    fileDropArea.classList.remove('dragover');
                });
        
                fileDropArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    fileDropArea.classList.remove('dragover');
        
                    var files = e.dataTransfer.files; // Obtener los archivos arrastrados
                    if (files.length > 0) {
                        fileInput.files = files; // Asignar archivos al input file
                        displayImage(files[0]); // Mostrar la imagen
                    }
                });
        
                // Mostrar la imagen seleccionada manualmente
                fileInput.addEventListener('change', function() {
                    if (fileInput.files.length > 0) {
                        displayImage(fileInput.files[0]); // Mostrar la imagen
                    } else {
                        resetFileArea(); // Resetear el área si no hay archivo
                    }
                });
        
                // Función para mostrar la imagen seleccionada o arrastrada
                function displayImage(file) {
                    if (file && file.type.startsWith('image/')) {
                        var reader = new FileReader();
                        reader.onload = function(e) {
                            previewImage.src = ''; // Limpiar la imagen previa
                            previewImage.src = e.target.result; // Establecer la nueva fuente de la imagen
                            previewImage.style.display = 'block'; // Mostrar la imagen
                            fileMessage.style.display = 'none'; // Ocultar el mensaje de "arrastra o selecciona"
                        };
                        reader.readAsDataURL(file); // Leer el archivo como una URL
                    } else {
                        resetFileArea(); // Resetear el área si no es una imagen válida
                    }
                }
        
                function resetFileArea() {
                    previewImage.style.display = 'none'; // Ocultar la imagen
                    previewImage.src = '';  // Restablecer la fuente de la imagen
                    fileMessage.style.display = 'block'; // Mostrar el mensaje de "arrastra o selecciona"
                }
            }
        });

        
        
        
        document.getElementById("btn-update-perfilpuesto").onclick = function(event) {
            event.preventDefault(); // Prevenir el envío por defecto del formulario
        
            const formData = new FormData();

            // 1. Captura tipo_perfil
            const tipoPerfil = document.getElementById('text').innerHTML === "PERFIL NUEVO" ? "PERFIL NUEVO" : "PERFIL EXISTENTE";
            formData.append('tipo_perfil', tipoPerfil);
            formData.append('empresa_select', document.getElementById('empresa_select').value);
            formData.append('nombre_cargo', document.getElementById('nombre_cargo').value);
            formData.append('departamento_select', document.getElementById('departamento_select').value);
            formData.append('cargo_reportan_select', document.getElementById('cargo_reportan_select').value);
            const leReportanSelect = document.getElementById('cargo_lereportan_select');
            const selectedOptions = Array.from(leReportanSelect.selectedOptions).map(option => option.value);
            formData.append('cargo_lereportan_select', JSON.stringify(selectedOptions));


            // 3. Educación y formación
            formData.append('educacion_input', document.getElementById('educacion_input').value);
            formData.append('postgrado_especialidades', document.getElementById('postgrado_especialidades').value);
            formData.append('formacion_complementaria', document.getElementById('formacion_complementaria').value);
            formData.append('idioma_input', document.getElementById('idioma_input').value);
            formData.append('nivel_idioma_select', document.getElementById('nivel_idioma_select').value);

            // 4. Competencias
            formData.append('anosexperiencia_input', document.getElementById('anosexperiencia_input').value);
            formData.append('nivel_pensamiento_select', document.getElementById('nivel_pensamiento_select').value);
            formData.append('nivel_cliente_select', document.getElementById('nivel_cliente_select').value);
            formData.append('nivel_planificacion_select', document.getElementById('nivel_planificacion_select').value);
            formData.append('nivel_comunicacion_select', document.getElementById('nivel_comunicacion_select').value);
            formData.append('nivel_logro_select', document.getElementById('nivel_logro_select').value);

            // 5. Mision y organigrama
            formData.append('mision_cargo', document.getElementById('mision_cargo').value);

            const imagenInput = document.getElementById('fileInput_org');
            if (imagenInput.files && imagenInput.files[0]) {
                const ext = imagenInput.files[0].name.split('.').pop().toLowerCase();
                if (ext === 'jpg' || ext === 'png') {
                    formData.append('ruta_organigrama', imagenInput.files[0]);
                } else {
                    Swal.fire({
                        title: 'Archivo no válido',
                        text: 'Por favor, sube una imagen en formato JPG o PNG.',
                        icon: 'error',
                        confirmButtonText: 'Aceptar',
                        customClass: { confirmButton: 'custom-alertas-button' }
                    });
                    return;
                }
            }

            // 5. Funciones del cargo
            const funciones = document.querySelectorAll('input[name="funcion[]"]');
            const periodicidades = document.querySelectorAll('select[name="periodicidad[]"]');
            const importancias = document.querySelectorAll('select[name="importancia[]"]');

            let lista_funciones = [];
            let lista_periodicidades = [];
            let lista_importancias = [];

            funciones.forEach((input, i) => {
                if (input.value && periodicidades[i] && importancias[i]) {
                    lista_funciones.push(input.value);
                    lista_periodicidades.push(periodicidades[i].value);
                    lista_importancias.push(importancias[i].value);
                }
            });

            // Enviar por separado como listas JSON
            formData.append('funcion_lista', JSON.stringify(lista_funciones));
            formData.append('periodicidad_lista', JSON.stringify(lista_periodicidades));
            formData.append('importancia_lista', JSON.stringify(lista_importancias));



            // 6. Dificultades dinámicas
            let dificultadesArray = [];
            document.querySelectorAll('input[name="dificultad[]"]').forEach(input => {
                if (input.value.trim()) dificultadesArray.push(input.value.trim());
            });
            formData.append('dificultades', JSON.stringify(dificultadesArray));


            // 7. Materiales seleccionados
            let materialesSeleccionados = [];
            document.querySelectorAll('input[name="material[]"]:checked').forEach(checkbox => {
                if (checkbox.value === 'Otros') {
                    const otrosVal = document.getElementById('inputOtros_equipos').value.trim();
                    if (otrosVal) materialesSeleccionados.push(otrosVal);
                } else {
                    materialesSeleccionados.push(checkbox.value);
                }
            });
            formData.append('materiales_equipos', JSON.stringify(materialesSeleccionados));

            // 9. Checkbox "Residir en el Área" y input "Turno-Horario"
            formData.append('residir_en_area', document.getElementById('recidirarea').checked);
            formData.append('hora_entrada', document.getElementById('hora_entrada').value);
            formData.append('hora_salida', document.getElementById('hora_salida').value);

            // Otros importantes
            formData.append('otros', document.getElementById('otros_importantes_textarea').value);

            // Plan de compensación
            let compensacionesSeleccionadas = [];
            document.querySelectorAll('input[name="compensacion[]"]:checked').forEach(checkbox => {
                if (checkbox.value === 'Otros') {
                    const valOtrosComp = document.getElementById('inputOtrosCompensacion').value.trim();
                    if (valOtrosComp) compensacionesSeleccionadas.push(valOtrosComp);
                } else {
                    compensacionesSeleccionadas.push(checkbox.value);
                }
            });
            formData.append('plan_de_compensacion', JSON.stringify(compensacionesSeleccionadas));

            // Beneficios Promaco
            let beneficiosSeleccionados = [];
            document.querySelectorAll('input[name="beneficio[]"]:checked').forEach(checkbox => {
                beneficiosSeleccionados.push(checkbox.value);
            });
            formData.append('beneficiospromaco', JSON.stringify(beneficiosSeleccionados));



            // 13. Nivel de la Prueba y Pruebas Psicométricas
            formData.append('nivel_prueba', document.getElementById('nivel_psicosmart').value);

            // 14. Montacargas y Equipo Pesado
            formData.append('montacargas', document.querySelector('input[name="montacargas"]').checked);
            formData.append('equipo_pesado', document.querySelector('input[name="equipo_pesado"]').checked);

            // 15. Indicadores dinámicos
            let indicadoresArray = [];
            document.querySelectorAll('input[name="indicador[]"]').forEach(input => {
                if (input.value.trim()) indicadoresArray.push(input.value.trim());
            });
            formData.append('principales_indicadores', JSON.stringify(indicadoresArray));
        
            const perfilPuestoId = document.getElementById('perfil_puesto_id').value;
            formData.append('perfilPuestoId', perfilPuestoId);

            // Enviar los datos al servidor para la actualización
            fetch(`/PerfilesPuestos/Update/${perfilPuestoId}/`, { 
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    Swal.fire({
                        title: 'Error',
                        text: data.message,
                        icon: 'warning',
                        confirmButtonText: 'Aceptar',
                        customClass: {
                            confirmButton: 'custom-alertas-button'
                        }
                    });
                } else {
                    Swal.fire({
                        title: 'Éxito',
                        text: 'Perfil de puesto actualizado correctamente',
                        icon: 'success',
                        confirmButtonText: 'Aceptar',
                        customClass: {
                            confirmButton: 'custom-alertas-button'
                        }
                    }).then(() => {
                        window.location.href = "/PerfilesPuestos/";
                    });
                }
            })
            .catch(error => {
                Swal.fire({
                    title: 'Error',
                    text: error.message,
                    icon: 'error',
                    confirmButtonText: 'Aceptar',
                    customClass: {
                        confirmButton: 'custom-alertas-button'
                    }
                });
            });
        
        };

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        

    document.addEventListener('DOMContentLoaded', function() {
        var paragraph = document.getElementById("text");
        var button = document.getElementById("toggleButton");
        var tipoPerfil = "{{ perfil_puesto.tipo_perfil }}";  // Capturar el valor de tipo_perfil desde Django
    
        // Verificar el estado inicial de perfil_puesto.tipo_perfil y ajustar el botón y el texto
        if (tipoPerfil === "PERFIL NUEVO") {
            paragraph.innerHTML = "PERFIL NUEVO";
            button.innerHTML = "PERFIL EXISTENTE";
        } else {
            paragraph.innerHTML = "PERFIL EXISTENTE";
            button.innerHTML = "PERFIL NUEVO";
        }
    });

    
function toggleTextAndField() {
  var paragraph = document.getElementById("text");
  var button = document.getElementById("toggleButton");
  // var dynamicField = document.getElementById("dynamicField"); // ya no se usa

  if (paragraph.innerHTML === "PERFIL NUEVO") {
    paragraph.innerHTML = "PERFIL EXISTENTE";
    button.innerHTML = "PERFIL NUEVO";
  } else {
    paragraph.innerHTML = "PERFIL NUEVO";
    button.innerHTML = "PERFIL EXISTENTE";
  }
}

        </script>
        <script src="{% static 'js/perfilpuesto/perfilpuestoupdate.js' %}"></script>
        <script src="{% static 'js/plugins/sweetaler2.min.js' %}"></script>
    </body>
</html>
